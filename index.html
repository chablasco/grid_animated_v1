<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CB Mythography of nations</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; background: black; }
    canvas { display: block; }
  </style>
</head>
<body>
<script>
let stillImg;
const cols = 22;
const rows = 14;
let cw = [], rh = [], tw = [], th = [];

function preload() {
  stillImg = loadImage("assets/02.png");
}

function setup() {
  createCanvas(windowWidth, windowHeight);
  noStroke();
  noCursor();

  for (let i = 0; i < cols; i++) cw[i] = 1;
  for (let j = 0; j < rows; j++) rh[j] = 1;
}

function draw() {
  background(0);
  if (!stillImg || !stillImg.width || !stillImg.height) return;

  updateSizes(millis() * 0.001, width, height);

  let y = 0;
  for (let r = 0; r < rows; r++) {
    let x = 0;
    for (let c = 0; c < cols; c++) {
      let dw = cw[c], dh = rh[r];

      // Map each grid cell directly to a proportional area of the image
      let sx = (c / cols) * stillImg.width;
      let sy = (r / rows) * stillImg.height;
      let sw = stillImg.width / cols;
      let sh = stillImg.height / rows;

      image(stillImg, x, y, dw, dh, sx, sy, sw, sh);
      x += dw;
    }
    y += rh[r];
  }
}

function updateSizes(t, targetW, targetH) {
  let sumW = 0, sumH = 0;
  for (let i = 0; i < cols; i++) {
    tw[i] = 0.2 + noise(i * 0.22, t * 0.55) * 1.8;
    sumW += tw[i];
  }
  for (let j = 0; j < rows; j++) {
    th[j] = 0.2 + noise(50 + j * 0.22, t * 0.52) * 1.8;
    sumH += th[j];
  }
  for (let i = 0; i < cols; i++) tw[i] = (tw[i] / sumW) * targetW;
  for (let j = 0; j < rows; j++) th[j] = (th[j] / sumH) * targetH;

  let a = 0.08;
  for (let i = 0; i < cols; i++) cw[i] = lerp(cw[i], tw[i], a);
  for (let j = 0; j < rows; j++) rh[j] = lerp(rh[j], th[j], a);
}

function mousePressed() {
  fullscreen(!fullscreen());
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
}
</script>
</body>
</html>
